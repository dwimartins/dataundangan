<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tools Rapihin Data Undangan</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        [x-cloak] { display: none !important; }
        .loader { border-top-color: #3498db; -webkit-animation: spinner 1.5s linear infinite; animation: spinner 1.5s linear infinite; }
        @keyframes spinner { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-gray-100 min-h-screen p-6 font-sans" x-data="appData()">

    <div x-show="!isLoggedIn" class="fixed inset-0 bg-gray-900 bg-opacity-90 flex items-center justify-center z-50">
        <div class="bg-white p-8 rounded-xl shadow-2xl max-w-sm w-full">
            <h2 class="text-xl font-bold mb-4 text-center">Login Tim</h2>
            <input type="password" x-model="inputPassword" @keyup.enter="login" placeholder="Masukkan Password Tim..." class="w-full border p-2 rounded mb-4">
            <button @click="login" class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700">Masuk</button>
            <p x-show="loginError" class="text-red-500 text-sm mt-2 text-center">Password salah!</p>
        </div>
    </div>

    <div x-show="isLoggedIn" x-cloak class="max-w-6xl mx-auto">
        <header class="mb-8 flex justify-between items-center">
            <h1 class="text-3xl font-bold text-gray-800">üõ†Ô∏è Perapih Data Undangan</h1>
            <div class="text-sm text-gray-500">Mode: Gemini AI Flash</div>
        </header>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            
            <div class="bg-white p-6 rounded-lg shadow-md h-fit">
                <h3 class="font-bold text-lg mb-4 text-gray-700">üìù Data Mentah (Dari Client)</h3>
                <textarea x-model="rawData" class="w-full h-96 border p-3 rounded-lg focus:ring-2 focus:ring-blue-500 font-mono text-sm" placeholder="Paste data berantakan disini...&#10;Contoh:&#10;nama: budi santoso s.kom&#10;alamat: jl sudirman no 5 medan"></textarea>
                
                <div class="mt-4 flex gap-2">
                    <button @click="processWithAI" :disabled="isLoading" class="flex-1 bg-indigo-600 text-white py-3 rounded-lg font-bold hover:bg-indigo-700 flex justify-center items-center gap-2 transition">
                        <span x-show="isLoading" class="loader ease-linear rounded-full border-4 border-t-4 border-gray-200 h-5 w-5"></span>
                        <span x-text="isLoading ? 'Sedang Mikir...' : '‚ú® Rapikan dengan AI'"></span>
                    </button>
                    <button @click="rawData = ''" class="bg-gray-200 text-gray-700 px-4 rounded-lg hover:bg-gray-300">Reset</button>
                </div>
            </div>

            <div class="bg-white p-6 rounded-lg shadow-md min-h-[500px]">
                <h3 class="font-bold text-lg mb-4 text-gray-700">‚úÖ Data Bersih (Siap Copy)</h3>
                
                <div x-show="!results.length" class="text-gray-400 text-center mt-20 italic">
                    Hasil perbaikan akan muncul di sini...
                </div>

                <div class="space-y-4">
                    <template x-for="(item, index) in results" :key="index">
                        <div class="border-b pb-4 last:border-0">
                            <div class="flex justify-between items-end mb-1">
                                <span class="text-xs font-semibold text-gray-500 uppercase" x-text="item.label"></span>
                            </div>
                            
                            <div class="flex gap-2">
                                <input type="text" x-model="item.value" class="flex-1 border p-2 rounded bg-gray-50 text-gray-800 font-medium">
                                
                                <button @click="copyToClipboard(item.value)" class="bg-green-100 text-green-700 p-2 rounded hover:bg-green-200" title="Copy">üìã</button>
                            </div>
                            
                            <div class="flex gap-2 mt-2 text-xs">
                                <button @click="item.value = toTitleCase(item.value)" class="text-blue-600 hover:underline">Title Case</button>
                                <button @click="item.value = item.value.toUpperCase()" class="text-blue-600 hover:underline">UPPER</button>
                                <button @click="item.value = item.value.toLowerCase()" class="text-blue-600 hover:underline">lower</button>
                            </div>
                        </div>
                    </template>
                </div>
            </div>
        </div>
    </div>

    <script>
        function appData() {
            return {
                // --- KONFIGURASI PENTING ---
                // Ganti 'PASSWORD_TIM' dengan password yang Anda mau
                teamPassword: 'admin', 
                
                // Masukkan API Key Gemini Anda di sini
                // Tips: Agar aman dari scanner GitHub, kita bisa split stringnya (contoh sederhana)
                // Atau paste langsung jika repo Private
                apiKey: 'AIzaSyCGztCrwOr1oJaPnB_5QxPGTvmH6zp8HvQ', 
                // ---------------------------

                isLoggedIn: false,
                inputPassword: '',
                loginError: false,
                rawData: '',
                isLoading: false,
                results: [],

                // Cek status login (bisa disimpan di localStorage biar ga login ulang terus)
                init() {
                    if (localStorage.getItem('undangan_auth') === 'true') {
                        this.isLoggedIn = true;
                    }
                },

                login() {
                    if (this.inputPassword === this.teamPassword) {
                        this.isLoggedIn = true;
                        this.loginError = false;
                        localStorage.setItem('undangan_auth', 'true');
                    } else {
                        this.loginError = true;
                    }
                },

                async processWithAI() {
    if (!this.rawData.trim()) return;
    this.isLoading = true;
    this.results = [];

    // Prompt yang diperkuat
    const prompt = `
        Kamu adalah asisten editor undangan pernikahan profesional. Tugasmu adalah merapikan data berantakan menjadi format JSON yang rapi sesuai EYD Bahasa Indonesia.
        
        Aturan:
        1. Perbaiki kapitalisasi (Nama Orang = Title Case, Gelar = Sesuai baku misal S.Kom., Alamat = Title Case).
        2. Perbaiki penulisan gelar (contoh: 's kom' -> 'S.Kom.', 'hajjah' -> 'Hj.').
        3. Ekstrak label data (misal: Nama Pria, Nama Wanita, Alamat, Ayah Pria, dll) berdasarkan konteks teks input.
        4. Output WAJIB hanya JSON Array murni tanpa format markdown.
        
        Data Input:
        ${this.rawData}
    `;

try {
    // UPDATED 2026: Menggunakan model 'gemini-2.5-flash' (Versi Aktif)
    // Model 1.5 sudah retired/tidak bisa dipakai lagi.
    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${this.apiKey}`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            contents: [{ parts: [{ text: prompt }] }],
            // Matikan Safety Filter agar teks undangan tidak diblokir
            safetySettings: [
                { category: "HARM_CATEGORY_HARASSMENT", threshold: "BLOCK_NONE" },
                { category: "HARM_CATEGORY_HATE_SPEECH", threshold: "BLOCK_NONE" },
                { category: "HARM_CATEGORY_SEXUALLY_EXPLICIT", threshold: "BLOCK_NONE" },
                { category: "HARM_CATEGORY_DANGEROUS_CONTENT", threshold: "BLOCK_NONE" }
            ]
        })
    });

    const data = await response.json();

    // Cek error dari Google
    if (data.error) {
        throw new Error(data.error.message); 
    }

    // Cek jika kena blokir Safety
    if (!data.candidates || !data.candidates[0].content) {
        throw new Error("Teks diblokir oleh Safety Filter. Coba bahasa yang lebih formal.");
    }

    const rawText = data.candidates[0].content.parts[0].text;
    const cleanJson = rawText.replace(/```json/g, '').replace(/```/g, '').trim();
    this.results = JSON.parse(cleanJson);

} catch (error) {
    console.error("Error Detail:", error);
    alert("Gagal: " + error.message);
} finally {
    this.isLoading = false;
}
},

                // Helper Functions
                copyToClipboard(text) {
                    navigator.clipboard.writeText(text);
                    // Bisa tambah notifikasi toast kecil disini
                },

                toTitleCase(str) {
                    return str.replace(/\w\S*/g, function(txt){
                        return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();
                    });
                }
            }
        }
    </script>
</body>
</html>
